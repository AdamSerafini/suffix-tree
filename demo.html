<!doctype html>
<head>
  <meta charset="UTF-8">
  <meta http-equiv="Content-Language" content="en">
</head>
<html lang="en">
  <body>
    <h2>Ukkonen's Algorithm: A Visual Guide</h2>
    <input id="input" type="text" value="xabxa$" maxlength="10">
    <div id="svgDiv">
      <!-- Target for dynamic svg generation -->
    </div>
    <style>
      svg {max-width: 100%;}
    </style>
  </body>
  <script src="lib/viz.min.js"></script>
  <script src="suffix_tree.js"></script>
  <script>
    // Display each phase of the Suffix Tree for the string in the input.

    // Initialise
    var suffix_tree = window.SuffixTree({noInitialRun: true});

    // DOM nodes
    var svgDiv = document.getElementById('svgDiv');
    var input = document.getElementById('input');


    /*
    Return the longest matching prefix of two strings where the 'longest
    matching prefix' of 'abc' and 'abd' is 'ab'.
    */
    var getPrefix = function(strA, strB) {
      var ret = '';
      var i = 0;
      var lA = strA.length, lB = strB.length;
      while (strA.charAt(i) == strB.charAt(i) && i < lA && i < lB) {
          ret += strA.charAt(i);
          i++;
      }
      return ret;
    }

    var render = function() {
      svgDiv.innerHTML = '';
      var str = input.value
      for (var i = 1, len = str.length; i <= len; ++i) {
        var slice = str.slice(0, i);
        var tree = Viz(suffix_tree.print_tree(slice), "svg");
        svgDiv.insertAdjacentHTML('beforeend', tree);
      }

    // A super-simple debouncer
    var debounce = function(func, wait) {
      var timeout;
      var later = function() {
        func.call();
      };
      return function() {
        clearTimeout(timeout);
        timeout = setTimeout(later, wait);
      };
    };

    // Add events
    document.addEventListener("DOMContentLoaded", render);
    input.addEventListener("input", debounce(render, 250));

  </script>
</html>
